# 🧩 Proyecto Maven — CRUD Octagonal en Java con Oracle 19c : .

<img width="1024" height="1024" alt="image" src="https://github.com/user-attachments/assets/a0f255d5-a446-4428-bbb6-e631690f6f52" />   

Proyecto Maven en **IntelliJ IDEA** que implementa un **CRUD en Java** siguiendo la arquitectura **Octagonal (Ports & Adapters)**.  
Persiste la información en una base de datos **Oracle 19c** mediante **JDBC**.

---

## 📁 Estructura del Proyecto

```bash
registro-personas-octagonal/
├─ pom.xml
├─ src/
│  └─ main/
│     ├─ java/
│     │  └─ com/example/registro/
│     │     ├─ AppMain.java
│     │     ├─ config/
│     │     │  └─ DataSourceConfig.java
│     │     ├─ domain/
│     │     │  └─ Persona.java
│     │     ├─ ports/
│     │     │  └─ PersonaRepository.java
│     │     ├─ adapters/
│     │     │  └─ jdbc/
│     │     │     └─ PersonaJdbcRepository.java
│     │     ├─ application/
│     │     │  └─ PersonaService.java
│     │     └─ cli/
│     │        └─ PersonaControllerCLI.java
│     └─ resources/
│        └─ application.properties
└─ sql/
   └─ create_table_personas.sql

## ⚙️ pom.xml

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.example</groupId>
  <artifactId>registro-personas-octagonal</artifactId>
  <version>1.0.0</version>

  <properties>
    <maven.compiler.source>17</maven.compiler.source>
    <maven.compiler.target>17</maven.compiler.target>
  </properties>

  <dependencies>
    <!-- Logging -->
    <dependency>
      <groupId>org.slf4j</groupId>
      <artifactId>slf4j-simple</artifactId>
      <version>2.0.9</version>
    </dependency>

    <!-- Anotaciones opcionales -->
    <dependency>
      <groupId>jakarta.annotation</groupId>
      <artifactId>jakarta.annotation-api</artifactId>
      <version>2.1.1</version>
    </dependency>

    <!-- Driver Oracle JDBC -->
    <dependency>
      <groupId>com.oracle.database.jdbc</groupId>
      <artifactId>ojdbc11</artifactId>
      <version>23.3.0.0</version>
      <scope>runtime</scope>
    </dependency>
  </dependencies>
</project>

🗃️ Script SQL — sql/create_table_personas.sql

CREATE TABLE PERSONAS (
  ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  NOMBRE VARCHAR2(100) NOT NULL,
  APELLIDO VARCHAR2(100),
  EMAIL VARCHAR2(150),
  EDAD NUMBER(3),
  FECHA_CREACION TIMESTAMP DEFAULT SYSTIMESTAMP
);

🧠 Dominio — Persona.java

package com.example.registro.domain;

import java.time.LocalDateTime;
import java.util.Objects;

public class Persona {
    private Long id;
    private String nombre;
    private String apellido;
    private String email;
    private Integer edad;
    private LocalDateTime fechaCreacion;

    public Persona() {}

    public Persona(Long id, String nombre, String apellido, String email, Integer edad, LocalDateTime fechaCreacion) {
        this.id = id;
        this.nombre = nombre;
        this.apellido = apellido;
        this.email = email;
        this.edad = edad;
        this.fechaCreacion = fechaCreacion;
    }

    public Persona(String nombre, String apellido, String email, Integer edad) {
        this(null, nombre, apellido, email, edad, null);
    }

    // Getters y Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getNombre() { return nombre; }
    public void setNombre(String nombre) { this.nombre = nombre; }
    public String getApellido() { return apellido; }
    public void setApellido(String apellido) { this.apellido = apellido; }
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    public Integer getEdad() { return edad; }
    public void setEdad(Integer edad) { this.edad = edad; }
    public LocalDateTime getFechaCreacion() { return fechaCreacion; }
    public void setFechaCreacion(LocalDateTime fechaCreacion) { this.fechaCreacion = fechaCreacion; }

    @Override
    public String toString() {
        return "Persona{" +
                "id=" + id +
                ", nombre='" + nombre + '\'' +
                ", apellido='" + apellido + '\'' +
                ", email='" + email + '\'' +
                ", edad=" + edad +
                ", fechaCreacion=" + fechaCreacion +
                '}';
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Persona)) return false;
        Persona persona = (Persona) o;
        return Objects.equals(id, persona.id);
    }

    @Override
    public int hashCode() {
        return Objects.hash(id);
    }
}

🔌 Puerto (Port) — PersonaRepository.java

package com.example.registro.ports;

import com.example.registro.domain.Persona;
import java.util.List;
import java.util.Optional;

public interface PersonaRepository {
    Persona save(Persona persona);
    Optional<Persona> findById(Long id);
    List<Persona> findAll();
    boolean deleteById(Long id);
}

🧱 Adaptador JDBC — PersonaJdbcRepository.java

package com.example.registro.adapters.jdbc;

import com.example.registro.domain.Persona;
import com.example.registro.ports.PersonaRepository;
import java.sql.*;
import java.time.LocalDateTime;
import java.util.*;
import javax.sql.DataSource;

public class PersonaJdbcRepository implements PersonaRepository {

    private final DataSource dataSource;

    public PersonaJdbcRepository(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    @Override
    public Persona save(Persona persona) {
        if (persona.getId() == null) {
            return insert(persona);
        } else {
            return update(persona);
        }
    }

    private Persona insert(Persona p) {
        String sql = "INSERT INTO PERSONAS (NOMBRE, APELLIDO, EMAIL, EDAD) VALUES (?, ?, ?, ?)";
        try (Connection conn = dataSource.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql, new String[]{"ID"})) {
            ps.setString(1, p.getNombre());
            ps.setString(2, p.getApellido());
            ps.setString(3, p.getEmail());
            if (p.getEdad() == null) ps.setNull(4, Types.INTEGER); else ps.setInt(4, p.getEdad());
            ps.executeUpdate();

            try (ResultSet rs = ps.getGeneratedKeys()) {
                if (rs.next()) p.setId(rs.getLong(1));
            }
            return findById(p.getId()).orElse(p);
        } catch (SQLException e) {
            throw new RuntimeException("Error insertando persona", e);
        }
    }

    private Persona update(Persona p) {
        String sql = "UPDATE PERSONAS SET NOMBRE=?, APELLIDO=?, EMAIL=?, EDAD=? WHERE ID=?";
        try (Connection conn = dataSource.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            ps.setString(1, p.getNombre());
            ps.setString(2, p.getApellido());
            ps.setString(3, p.getEmail());
            if (p.getEdad() == null) ps.setNull(4, Types.INTEGER); else ps.setInt(4, p.getEdad());
            ps.setLong(5, p.getId());
            ps.executeUpdate();
            return findById(p.getId()).orElse(p);
        } catch (SQLException e) {
            throw new RuntimeException("Error actualizando persona", e);
        }
    }

    @Override
    public Optional<Persona> findById(Long id) {
        String sql = "SELECT * FROM PERSONAS WHERE ID=?";
        try (Connection conn = dataSource.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            ps.setLong(1, id);
            try (ResultSet rs = ps.executeQuery()) {
                if (rs.next()) return Optional.of(mapRow(rs));
                return Optional.empty();
            }
        } catch (SQLException e) {
            throw new RuntimeException("Error consultando persona por id", e);
        }
    }

    @Override
    public List<Persona> findAll() {
        String sql = "SELECT * FROM PERSONAS ORDER BY ID";
        List<Persona> list = new ArrayList<>();
        try (Connection conn = dataSource.getConnection();
             Statement st = conn.createStatement();
             ResultSet rs = st.executeQuery(sql)) {
            while (rs.next()) list.add(mapRow(rs));
            return list;
        } catch (SQLException e) {
            throw new RuntimeException("Error consultando todas las personas", e);
        }
    }

    @Override
    public boolean deleteById(Long id) {
        String sql = "DELETE FROM PERSONAS WHERE ID=?";
        try (Connection conn = dataSource.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            ps.setLong(1, id);
            return ps.executeUpdate() > 0;
        } catch (SQLException e) {
            throw new RuntimeException("Error eliminando persona", e);
        }
    }

    private Persona mapRow(ResultSet rs) throws SQLException {
        return new Persona(
                rs.getLong("ID"),
                rs.getString("NOMBRE"),
                rs.getString("APELLIDO"),
                rs.getString("EMAIL"),
                rs.getInt("EDAD"),
                rs.getTimestamp("FECHA_CREACION").toLocalDateTime()
        );
    }
}

⚙️ Configuración — DataSourceConfig.java

package com.example.registro.config;

import javax.sql.DataSource;
import oracle.jdbc.pool.OracleDataSource;
import java.sql.SQLException;

public final class DataSourceConfig {
    private DataSourceConfig() {}

    public static DataSource build(String url, String user, String password) {
        try {
            OracleDataSource ods = new OracleDataSource();
            ods.setURL(url);
            ods.setUser(user);
            ods.setPassword(password);
            return ods;
        } catch (SQLException e) {
            throw new RuntimeException("No se pudo crear DataSource", e);
        }
    }
}

🧩 Servicio (Application) — PersonaService.java

package com.example.registro.application;

import com.example.registro.domain.Persona;
import com.example.registro.ports.PersonaRepository;

import java.util.List;
import java.util.Optional;

public class PersonaService {
    private final PersonaRepository repository;

    public PersonaService(PersonaRepository repository) {
        this.repository = repository;
    }

    public Persona crearPersona(String nombre, String apellido, String email, Integer edad) {
        return repository.save(new Persona(nombre, apellido, email, edad));
    }

    public Persona actualizarPersona(Long id, String nombre, String apellido, String email, Integer edad) {
        Persona p = repository.findById(id)
                .orElseThrow(() -> new IllegalArgumentException("Persona no encontrada: " + id));
        p.setNombre(nombre);
        p.setApellido(apellido);
        p.setEmail(email);
        p.setEdad(edad);
        return repository.save(p);
    }

    public Optional<Persona> obtenerPorId(Long id) { return repository.findById(id); }
    public List<Persona> listarTodas() { return repository.findAll(); }
    public boolean eliminar(Long id) { return repository.deleteById(id); }
}

🧮 Controlador CLI — PersonaControllerCLI.java

package com.example.registro.cli;

import com.example.registro.application.PersonaService;
import com.example.registro.domain.Persona;
import java.util.*;
import java.util.Scanner;

public class PersonaControllerCLI {
    private final PersonaService service;
    private final Scanner scanner = new Scanner(System.in);

    public PersonaControllerCLI(PersonaService service) {
        this.service = service;
    }

    public void start() {
        while (true) {
            System.out.println("\n--- CRUD PERSONAS (Octagonal) ---");
            System.out.println("1. Crear persona");
            System.out.println("2. Listar personas");
            System.out.println("3. Buscar por ID");
            System.out.println("4. Actualizar persona");
            System.out.println("5. Eliminar persona");
            System.out.println("0. Salir");
            System.out.print("Opción: ");
            String opt = scanner.nextLine();
            try {
                switch (opt) {
                    case "1" -> crear();
                    case "2" -> listar();
                    case "3" -> buscar();
                    case "4" -> actualizar();
                    case "5" -> eliminar();
                    case "0" -> { System.out.println("Saliendo..."); return; }
                    default -> System.out.println("Opción inválida");
                }
            } catch (Exception e) {
                System.out.println("Error: " + e.getMessage());
            }
        }
    }

    private void crear() {
        System.out.print("Nombre: "); String nombre = scanner.nextLine();
        System.out.print("Apellido: "); String apellido = scanner.nextLine();
        System.out.print("Email: "); String email = scanner.nextLine();
        System.out.print("Edad: "); Integer edad = parseIntNullable(scanner.nextLine());
        System.out.println("Creado: " + service.crearPersona(nombre, apellido, email, edad));
    }

    private void listar() {
        var all = service.listarTodas();
        System.out.println("Total: " + all.size());
        all.forEach(System.out::println);
    }

    private void buscar() {
        System.out.print("ID: "); Long id = Long.parseLong(scanner.nextLine());
        System.out.println(service.obtenerPorId(id).orElse(null));
    }

    private void actualizar() {
        System.out.print("ID: "); Long id = Long.parseLong(scanner.nextLine());
        System.out.print("Nombre: "); String nombre = scanner.nextLine();
        System.out.print("Apellido: "); String apellido = scanner.nextLine();
        System.out.print("Email: "); String email = scanner.nextLine();
        System.out.print("Edad: "); Integer edad = parseIntNullable(scanner.nextLine());
        System.out.println("Actualizado: " + service.actualizarPersona(id, nombre, apellido, email, edad));
    }

    private void eliminar() {
        System.out.print("ID: "); Long id = Long.parseLong(scanner.nextLine());
        System.out.println(service.eliminar(id) ? "Eliminado" : "No encontrado");
    }

    private Integer parseIntNullable(String s) {
        if (s == null || s.isBlank()) return null;
        try { return Integer.parseInt(s.trim()); } catch (NumberFormatException e) { return null; }
    }
}

🚀 Main — AppMain.java

package com.example.registro;

import com.example.registro.adapters.jdbc.PersonaJdbcRepository;
import com.example.registro.application.PersonaService;
import com.example.registro.cli.PersonaControllerCLI;
import com.example.registro.config.DataSourceConfig;

import javax.sql.DataSource;

public class AppMain {
    public static void main(String[] args) {
        String url = "jdbc:oracle:thin:@//localhost:1521/ORCLPDB1"; // Ajusta según tu Oracle
        String user = "APP_USER";
        String password = "app_password";

        DataSource ds = DataSourceConfig.build(url, user, password);
        var repo = new PersonaJdbcRepository(ds);
        var service = new PersonaService(repo);
        new PersonaControllerCLI(service).start();
    }
}

🧰 Configuración del driver Oracle
Si Maven no puede descargar el ojdbc11 automáticamente, sigue uno de estos metodos :

📥 Opción 1: Instalar manualmente en tu repositorio local .

mvn install:install-file \
  -Dfile=/ruta/a/ojdbc11.jar \
  -DgroupId=com.oracle.database.jdbc \
  -DartifactId=ojdbc11 \
  -Dversion=23.3.0.0 \
  -Dpackaging=jar

📦 Opción 2: Agregar manualmente en IntelliJ
Ve a:

File → Project Structure → Libraries → + → Java → selecciona ojdbc11.jar .
🧭 Pasos para ejecutar en IntelliJ IDEA
Crea un nuevo proyecto Maven.

Copia el contenido del pom.xml mostrado arriba.

Crea los paquetes y clases según la estructura.

Asegúrate de tener ojdbc11.jar en tu classpath.

Ejecuta el script SQL sql/create_table_personas.sql en Oracle 19c.

Edita AppMain.java con tu url, user y password.

Ejecuta AppMain → se abrirá el CLI CRUD en la consola  .

💡 Mejoras sugeridas
✅ Validaciones y DTOs

🌐 Adaptador REST con Spring Boot

🧪 Pruebas unitarias (JUnit + Mockito)

🗄️ Migraciones con Flyway/Liquibase

🖥️ Interfaz gráfica con Swing o JavaFX :.  
